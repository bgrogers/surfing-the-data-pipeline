

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>4. Acquiring Data from APIs &#8212; Surfing the Data Pipeline with Python</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Web Scraping Using BeautifulSoup" href="ch5.html" />
    <link rel="prev" title="3. Loading, Converting, and Writing JSON Files" href="ch3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/surf.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Surfing the Data Pipeline with Python</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Surfing the Data Pipeline with Python
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="ch1.html">
   1. Getting Yourself Unstuck
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch2.html">
   2. Loading Data from Electronic Data Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch3.html">
   3. Loading, Converting, and Writing JSON Files
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4. Acquiring Data from APIs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch5.html">
   5. Web Scraping Using
   <code class="docutils literal notranslate">
    <span class="pre">
     BeautifulSoup
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch6.html">
   6. Creating and Connecting to Databases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch7.html">
   7. Database Queries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch8.html">
   8. Data Wrangling with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch9.html">
   9. Reshaping and Merging Data and Working with Strings, Dates, and Times
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch10.html">
   10. Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch11.html">
   11. Static Data Visualizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch12.html">
   12. Interactive Data Visualizations and Dashboards
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/ch4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-what-is-an-api">
   4.1. Introduction: What is an API?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transfering-data-over-the-internet">
     4.1.1. Transfering Data Over the Internet
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dealing-with-api-jargon">
     4.1.2. Dealing with API Jargon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-api-documentation-example-the-nasa-image-and-video-library">
     4.1.3. Reading API Documentation (Example: the NASA Image and Video Library)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-requests-library-example-wikipedia">
   4.2. Using the
   <code class="docutils literal notranslate">
    <span class="pre">
     requests
    </span>
   </code>
   Library (Example: Wikipedia)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#obtaining-and-handling-api-keys-example-the-u-s-census-bureau">
   4.3. Obtaining and Handling API Keys (Example: the U.S. Census Bureau)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-keep-your-access-key-secret">
     4.3.1. How to Keep Your Access Key Secret
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-1-creating-a-environmental-variables-file">
       4.3.1.1. Step 1: Creating a Environmental Variables File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-2-putting-access-keys-into-the-env-file">
       4.3.1.2. Step 2: Putting Access Keys Into the
       <code class="docutils literal notranslate">
        <span class="pre">
         .env
        </span>
       </code>
       File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-3-loading-the-environmental-variables-into-python">
       4.3.1.3. Step 3: Loading the Environmental Variables into Python
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-4-using-the-access-key">
       4.3.1.4. Step 4: Using the Access Key
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-python-libraries-that-directly-interface-with-a-particular-api">
   4.4. Using Python Libraries that Directly Interface With a Particular API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-an-api-with-credentialling-and-limits-example-twitter">
     4.4.1. Using an API with Credentialling and Limits (Example: Twitter)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-an-api-that-requires-a-user-to-send-data-to-the-api-first-example-google-maps">
     4.4.2. Using an API that Requires a User to Send Data to the API First (Example: Google Maps)
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="acquiring-data-from-apis">
<h1><a class="toc-backref" href="#id1"><span class="section-number">4. </span>Acquiring Data from APIs</a><a class="headerlink" href="#acquiring-data-from-apis" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#acquiring-data-from-apis" id="id1">Acquiring Data from APIs</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction-what-is-an-api" id="id2">Introduction: What is an API?</a></p>
<ul>
<li><p><a class="reference internal" href="#transfering-data-over-the-internet" id="id3">Transfering Data Over the Internet</a></p></li>
<li><p><a class="reference internal" href="#dealing-with-api-jargon" id="id4">Dealing with API Jargon</a></p></li>
<li><p><a class="reference internal" href="#reading-api-documentation-example-the-nasa-image-and-video-library" id="id5">Reading API Documentation (Example: the NASA Image and Video Library)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-requests-library-example-wikipedia" id="id6">Using the <code class="docutils literal notranslate"><span class="pre">requests</span></code> Library (Example: Wikipedia)</a></p></li>
<li><p><a class="reference internal" href="#obtaining-and-handling-api-keys-example-the-u-s-census-bureau" id="id7">Obtaining and Handling API Keys (Example: the U.S. Census Bureau)</a></p>
<ul>
<li><p><a class="reference internal" href="#how-to-keep-your-access-key-secret" id="id8">How to Keep Your Access Key Secret</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1-creating-a-environmental-variables-file" id="id9">Step 1: Creating a Environmental Variables File</a></p></li>
<li><p><a class="reference internal" href="#step-2-putting-access-keys-into-the-env-file" id="id10">Step 2: Putting Access Keys Into the <code class="docutils literal notranslate"><span class="pre">.env</span></code> File</a></p></li>
<li><p><a class="reference internal" href="#step-3-loading-the-environmental-variables-into-python" id="id11">Step 3: Loading the Environmental Variables into Python</a></p></li>
<li><p><a class="reference internal" href="#step-4-using-the-access-key" id="id12">Step 4: Using the Access Key</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-python-libraries-that-directly-interface-with-a-particular-api" id="id13">Using Python Libraries that Directly Interface With a Particular API</a></p>
<ul>
<li><p><a class="reference internal" href="#using-an-api-with-credentialling-and-limits-example-twitter" id="id14">Using an API with Credentialling and Limits (Example: Twitter)</a></p></li>
<li><p><a class="reference internal" href="#using-an-api-that-requires-a-user-to-send-data-to-the-api-first-example-google-maps" id="id15">Using an API that Requires a User to Send Data to the API First (Example: Google Maps)</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction-what-is-an-api">
<h2><a class="toc-backref" href="#id2"><span class="section-number">4.1. </span>Introduction: What is an API?</a><a class="headerlink" href="#introduction-what-is-an-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transfering-data-over-the-internet">
<h3><a class="toc-backref" href="#id3"><span class="section-number">4.1.1. </span>Transfering Data Over the Internet</a><a class="headerlink" href="#transfering-data-over-the-internet" title="Permalink to this headline">¶</a></h3>
<p>Where do we get our data? That depends on who is providing the data. In the simplest of cases, the data provider gives us a single file in CSV or JSON format. But some of the most important data providers are extremely big operations: social media companies, search engines, governments, finance firms, etc. Getting data from these organizations is more complicated than asking for a data file, but it is very possible to do using the application programming interfaces (APIs) that these organizations have set-up and made available online.</p>
<p>It’s not feasible for these organizations to interact personally with every individual who requests data because every request may be unique, asking for different records, features, timeframes, locations, and formatting. In addition, to fulfill a request, the data provider might need information from the data requester first: for example, if I want Google Maps to give me the latitudinal and longitudinal coordinates of my house, I first need to tell Google Maps my address. In short, there are too many requests for humans to handle given that each request requires a conversation between the person providing the data and the person requesting the data.</p>
<p>Organizations instead store and share their data electronically through automated <strong>web applications</strong>. A web application has three parts: the user interface (the frontend), the data storage and organization system (the backend), and an API that connects the frontend and backend. Many authors, including <a class="reference external" href="https://www.oreilly.com/library/view/python-api-development/9781838983994/">Huang, Chung, and Chan</a>, use the analogy of a restaurant to describe an API. Customers place orders for the chefs to prepare, and waiters take the orders to the chefs, and return the food to the customers. In this analogy, customers are the frontend, issuing data requests; chefs are the backend, organizing and disseminating data; and waiters are the API, conducting the communication between the frontend and backend. Another analogy is the way our brains receive and react to sensory information. In this case, our senses comprise the API that connects the outside world to the internal workings of our brains.</p>
<p>APIs usually send and receive data in JSON (and sometimes XML) format. So being very comfortable with JSON formatted data is essential for working with APIs.</p>
<p>There are many reasons why big organizations would want to share their data. Governments might be required by law to provide general access to public data. For profit companies like Google and Twitter share data to enable the development of third-party web applications that do useful things with the data. Twitter recently bought out <a class="reference external" href="https://www.aiden.ai/">aiden.ai</a>, a company that uses Twitter data to train AI models for marketing. (It’s a brilliant strategy. By making their data available, Twitter encourages the creation of start-ups that are entirely dependent on Twitter data with no additional investment from Twitter. Then Twitter can use its data as leverage to buy-out the most successful start-ups for below market price.) Financial firms and other companies charge subscription fees for access to their data.</p>
<p>A carefully-constructed API also gives data providers certain powers over the data users. First, data providers might first require that users register for access to the API, surrendering their own personal information in exchange for access keys. Second, data providers can tightly control what and how much data they share. This power is called <strong>encapsulation</strong>. <a class="reference external" href="http://computationalculture.net/objects-of-intense-feeling-the-case-of-the-twitter-api/">Taina Bucher (2013)</a> writes that encapulation also gives data providers the power to shape the narrative that a selection of shared data will tell:</p>
<blockquote>
<div><p>While there is nothing wrong with using APIs to collect data, of course, researchers should be wary about letting any current obsessions with big data overshadow the fact that APIs are far from neutral tools… . APIs have ‘politics’, meaning that they can be seen as having ‘powerful consequences for the social activities that happen with them, and in the worlds imagined by them’.</p>
</div></blockquote>
<p>So when using an API, it’s a good idea to think about what data are being shared, and what data are not being shared, why, and what that means for the analysis you are working on.</p>
</div>
<div class="section" id="dealing-with-api-jargon">
<h3><a class="toc-backref" href="#id4"><span class="section-number">4.1.2. </span>Dealing with API Jargon</a><a class="headerlink" href="#dealing-with-api-jargon" title="Permalink to this headline">¶</a></h3>
<p>Getting started with APIs can be confusing because of all the technical jargon that API documentation uses. But once you are familiar with this language, it gets a lot easier to use APIs.</p>
<p>Regardless of the analogy that helps us understand what an API does, an essential characteristic of systems that APIs serve is “client-server separation”. That is, the system that interacts with the users and the system that interacts with the data must be separate and independent of each other. That way problems in one system do not cause problems in the other system, and either system can be replaced. Twitter’s data server can interact with many different third-party user clients through its API.</p>
<p>Client-server separation is one property an API needs to satisfy in order to meet the <strong>Representational State Transfer (REST)</strong> standards. An API that meets these standards is called a REST API (or “RESTful”). In addition to client-server separation, a REST API is stateless, which means that every request is independent of all other requests. That is, a request should produce the same output from the API regardless of whatever other requests have already been made. A REST API is also cacheable, which means that responses can be stored and retrieved when needed. If a new request exactly duplicates an old request, the API can use its stored cache from the old request to provide an instant response to the new request. A REST API should include a uniform user interface, so that all users see the same interface and interact with the API in the same way, and a REST API should include layers, so that distinct tasks are handled by many distinct sub-systems.</p>
<p>APIs are designed to handle all transfers of data from the backend to the frontend, and vice versa. For that, there are basic functions (also called “verbs”) that an API can execute. The two most common functions are GET, which pulls data from the backend, and POST, which stores new data in the backend. We can use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library in Python to issue both GET and POST commands. In addition, we can use PUT to replace a record in the backend with a new version, PATCH to make changes to an existing record, or DELETE to remove a record. These five verbs are part of the standard method for transfering information from servers to browsers over the internet, called the <strong>hypertext transfer protocol (HTTP)</strong>, and responses from a REST API include <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP numeric status codes</a>: 200 indicates a successful request, for example, and 404 means that the resource could not be found (maybe because there’s a typo in the web address we entered). More generally, these functions are also called CRUD (create, read, update, and delete) operations.</p>
</div>
<div class="section" id="reading-api-documentation-example-the-nasa-image-and-video-library">
<h3><a class="toc-backref" href="#id5"><span class="section-number">4.1.3. </span>Reading API Documentation (Example: the NASA Image and Video Library)</a><a class="headerlink" href="#reading-api-documentation-example-the-nasa-image-and-video-library" title="Permalink to this headline">¶</a></h3>
<p>Most web-applications with an API include documentation to guide people who want to use the API. Knowing <em>how</em> to read the documentation, that is, knowing the jargon, is the most important skill for using an API. First, please note that like other kinds of documentation, some software authors take more care to produce good documentation than others. Still, all API documentation should share some universal characteristics:</p>
<ul class="simple">
<li><p>The most important piece of information to find in the documentation is the <strong>root</strong> and <strong>endpoint</strong>. The API root is a web-address for all resources that exist and are accessable through the API. The endpoint is a subdirectory where records of a specific type are stored.</p></li>
<li><p>Each endpoint will usually have a separate section in the API documentation that contains a description of the kinds of data stored in this endpoint, a list of <strong>parameters</strong> to narrow down the data being requested, and (hopefully lots of) examples.</p></li>
<li><p>Finally, if an API requires authentication, there should be instructions on how to register for an <strong>access key</strong>.</p></li>
</ul>
<p>The goal is to generate a complete URL that points to the desired data by putting the root, endpoint, parameters, and access key together in the following way:</p>
<p><em>root</em> <strong>/</strong> <em>endpoint</em> <strong>?</strong> <em>parameters=value</em> <strong>&amp;</strong> <em>key=value</em></p>
<p>Let’s use as an example the API to access <a class="reference external" href="https://images.nasa.gov/">NASA’s Image and Video Library</a>. The documentation for this API is available at https://images.nasa.gov/docs/images.nasa.gov_api_docs.pdf. This API does not require authentication, so we only need to find the root, endpoint, and parameters. Let’s say that I want to find a photo of the moon. According to the documentation, the root is https://images-api.nasa.gov, and there are several endpoints including one dedicated to searches (<code class="docutils literal notranslate"><span class="pre">/search</span></code>).</p>
<p>I scroll down to the section devoted to this endpoint and look at the parameters to see which ones will allow me to search for a photo of the moon. I can use the <code class="docutils literal notranslate"><span class="pre">q</span></code> parameter to enter free text as a search term, and the <code class="docutils literal notranslate"><span class="pre">media_type</span></code> parameter set equal to <code class="docutils literal notranslate"><span class="pre">image</span></code> to find a photo.</p>
<p>Therefore the complete URL for this API GET request is: https://images-api.nasa.gov/search?q=moon&amp;media_type=image. Go ahead and click on this link. You will see a JSON file in which the metadata tells me there are 8626 hits in this search. Under the <code class="docutils literal notranslate"><span class="pre">data</span></code> header, the first result is an image entitled “Nearside of the Moon”, which has a NASA ID code PIA12235.</p>
<p>Next I want to GET the URL for the JSON data related to this specific image. The endpoint to find a specific image is <code class="docutils literal notranslate"><span class="pre">/asset</span></code>. There’s only one parameter, the NASA ID. Notice that the documentation lists this path as <code class="docutils literal notranslate"><span class="pre">asset/{nasa_id}</span></code> and NOT as <code class="docutils literal notranslate"><span class="pre">asset</span> <span class="pre">?</span> <span class="pre">nasa_id</span> <span class="pre">=</span> <span class="pre">{nasa_id}</span></code>. That means that for this particular endpoint we simply enter a slash and the ID after the endpoint. So to see the JSON data stored for this image, the URL is https://images-api.nasa.gov/asset/PIA12235. This JSON contains the links to various image files. I can link to one of them to display it in this document:</p>
<img src="https://images-assets.nasa.gov/image/PIA12235/PIA12235~small.jpg">
<p>Some documentation also contain API schematics that visualize the endpoints and the interaction between the frontend and backend via the API. As an example, here’s a schematic of an API for a project we are working on with <a class="reference external" href="https://codeforcharlottesville.org">Code for Charlottesville</a>, a local chapter of <a class="reference external" href="https://codeforamerica.org">Code for America</a> that I help to run. Our project involves building software for the agenices in town that help people with housing insecurity find a place to live. Our web application will allow people at different agencies share their data about available rental properties and landlords who are willing to rent to people with vouchers and who might have other complicated situations. Here’s our API’s schematic:
<img src="https://github.com/code-for-charlottesville/housinghub/raw/master/backend/docs/JWT%20Auth%20Workflow.png" width=800></p>
<p>Different API schematics vary in their presentation, but here the blue box represents the frontend interface that people at the housing agency will be using, the green boxes represent parts of the backend where different parts of the database will be stored, and the yellow blocks are notes that help our volunteers keep track of what each part of the schematic means. The arrows point either from the frontend to the backend, or from the backend to the frontend, and illustrate the data that is being sent from the origin to the destination. There are five endpoints. <code class="docutils literal notranslate"><span class="pre">/auth/register</span></code> stores the information about the users of the web-application and allows new users to input their information into the backend with a POST function. <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code> allows registered users to POST their username and password. <code class="docutils literal notranslate"><span class="pre">/auth/status</span></code> allows users to GET their current login status, and <code class="docutils literal notranslate"><span class="pre">/auth/logout</span></code> allows users to GET confirmation that they’ve logged out. <code class="docutils literal notranslate"><span class="pre">/property</span></code> allows the housing agency users to GET information about available properties and landlords. Throughout the schematic, JWT stands for <a class="reference external" href="https://jwt.io/introduction/">Javascript web token</a>, a JSON file with extra security built in for secure web transfers. So get a list of properties, a user enters information to filter the search into the frontend, and this information is converted into a JSON file and passed to the <code class="docutils literal notranslate"><span class="pre">/property</span></code> endpoint of the backend, which sends back a JSON file containing a list of the relevant properties.</p>
</div>
</div>
<div class="section" id="using-the-requests-library-example-wikipedia">
<h2><a class="toc-backref" href="#id6"><span class="section-number">4.2. </span>Using the <code class="docutils literal notranslate"><span class="pre">requests</span></code> Library (Example: Wikipedia)</a><a class="headerlink" href="#using-the-requests-library-example-wikipedia" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">requests</span></code> library in Python is one of the most widely used and one of the most important extensions to Python. If you need to install or update the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library, type <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">requests</span></code> in a console window. Then load the library. As we will be working with JSON data, it will be necessary to load the <code class="docutils literal notranslate"><span class="pre">json</span></code> library as well. It’s also a good habit to always load <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>In the example of the NASA Video and Image library, we read the API documentation to build URLs that led us to JSON data we could display in a web browser. But if we want to use that JSON data in Python, <code class="docutils literal notranslate"><span class="pre">requests</span></code> connects to APIs and brings the output into Python’s memory. We can access the data we requested and apply the methods we learned about in module 3 to convert the JSON structure to a data frame.</p>
<p>Here we will discuss the use of <code class="docutils literal notranslate"><span class="pre">requests</span></code> by working with the examples of Wikipedia.</p>
<p>Wikipedia’s API is entirely open and allows users to access anything that exists on any Wikipedia page. But Wikipedia’s API is also huge, and that necessitates a system for passing options to the Wikipedia API to let the server know what data you are asking for and how that data should be prepared. We will have to use the <strong>documentation</strong> for the Wikipedia API to navigate it.</p>
<p><strong>Our goal in this example:</strong> to pull the text of the <a class="reference external" href="https://en.wikipedia.org/wiki/University_of_Virginia">Wikipedia page for UVA</a> into Python. Wikipedia’s title for this page is <code class="docutils literal notranslate"><span class="pre">University_of_Virginia</span></code>.</p>
<p>The Wikipedia API documentation is here: https://www.mediawiki.org/wiki/API:Main_page. First, we have to choose the correct version of Wikipedia in the endpoint table. We will be using the English langauge API: https://en.wikipedia.org/w/api.php.</p>
<p>To connect to this enpoint to make a GET request, use the <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/w/api.php&quot;</span><span class="p">)</span>
<span class="n">r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Response [200]&gt;
</pre></div>
</div>
</div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code>, stored in <code class="docutils literal notranslate"><span class="pre">r</span></code>, displays the HTTP response by default. 200 means that <code class="docutils literal notranslate"><span class="pre">requests</span></code> was able to successfully connect to the endpoint we provided.</p>
<p>To extract the text of the UVA page, we need to specify the correct parameters. We return to the Wikipedia API documentation page and look along the side. There’s a link for <a class="reference external" href="https://www.mediawiki.org/wiki/API:Get_the_contents_of_a_page">Get the contents of a page</a>. Here the documentation lists several sets of instructions for retrieving the content of a page. Method 1 requires the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">action=query</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prop=revisions</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titles=University_of_Virginia</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rvslots=*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rvprop=content</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">formatversion=2</span></code></p></li>
</ul>
<p>We also add <code class="docutils literal notranslate"><span class="pre">format=json</span></code> to get JSON formatted output. We could either use these parameters to construct the following URL:
https://en.wikipedia.org/w/api.php?action=query&amp;prop=revisions&amp;titles=University_of_Virginia&amp;rvslots=*&amp;rvprop=content&amp;formatversion=2&amp;format=json</p>
<p>Or we can organize these parameters in a dictionary and pass them to the <code class="docutils literal notranslate"><span class="pre">params</span></code> argument of <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
         <span class="s1">&#39;prop&#39;</span><span class="p">:</span> <span class="s1">&#39;revisions&#39;</span><span class="p">,</span>
          <span class="s1">&#39;titles&#39;</span><span class="p">:</span> <span class="s1">&#39;University_of_Virginia&#39;</span><span class="p">,</span>
          <span class="s1">&#39;rvslots&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
          <span class="s1">&#39;rvprop&#39;</span><span class="p">:</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span>
          <span class="s1">&#39;formatversion&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
          <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/w/api.php&quot;</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">p_dict</span><span class="p">)</span>
<span class="n">r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Response [200]&gt;
</pre></div>
</div>
</div>
</div>
<p>To extract the JSON data, use the <code class="docutils literal notranslate"><span class="pre">.text</span></code> attribute and the <code class="docutils literal notranslate"><span class="pre">json.loads()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uva_wiki</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The text we need is buried in this JSON data. It turns out that the text we need exists in the following path:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uva_text</span> <span class="o">=</span> <span class="n">uva_wiki</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;pages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;revisions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;slots&#39;</span><span class="p">][</span><span class="s1">&#39;main&#39;</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uva_text</span><span class="p">)[</span><span class="mi">6000</span><span class="p">:</span><span class="mi">7000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>ebsite = Trends.collegeboard.org |access-date = February 1, 2016 |url-status=live |archive-url = https://web.archive.org/web/20151019085556/http://trends.collegeboard.org/college-pricing/figures-tables/2014-15-tuition-fees-flagship-universities-time |archive-date = October 19, 2015 }}&lt;/ref&gt;&lt;ref name=&quot;WHS&quot;&gt;{{cite web |url = https://whc.unesco.org/en/list/442 |title = Monticello and the University of Virginia in Charlottesville |website = UNESCO World Heritage Centre |access-date = March 3, 2020}}&lt;/ref&gt; UVA is known for [[#1800s|its historic foundations]], [[#Honor system|student-run]] [[honor code]] and [[Secret societies at the University of Virginia|secret societies]].

The original governing Board of Visitors included Jefferson, [[James Madison]], and [[James Monroe]]. Monroe was the sitting [[President of the United States]] at the time of its foundation, and earlier Presidents Jefferson and Madison were UVA&#39;s first two [[Rector (academia)#United States|rectors]]. Jefferson conceive
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="obtaining-and-handling-api-keys-example-the-u-s-census-bureau">
<h2><a class="toc-backref" href="#id7"><span class="section-number">4.3. </span>Obtaining and Handling API Keys (Example: the U.S. Census Bureau)</a><a class="headerlink" href="#obtaining-and-handling-api-keys-example-the-u-s-census-bureau" title="Permalink to this headline">¶</a></h2>
<p>APIs like the NASA Image and Video Library and Wikipedia are entirely open. Anyone can access these APIs without registration and without having to supply credentials. But many APIs do make users first go through an authentication process to access the data. There are many reasons why a data provider might want to control access in this way. The data provider might just want information about who is using the API and for what purposes. Additionally, many APIs place restructions to limit how much one account can use the API. <strong>Rate limits</strong> set maximum numbers of total calls one account can make to the API in a specified period of time, possibly to protect the backend from crashing. Some APIs charge for access, or set tiers of accessibility at different price points. For whatever reason, if the data provider has a reason to keep track of who is using the API and how much they use it, the API will require an <strong>access key</strong>.</p>
<p>To obtain an access key, find the documentation for the API online. There should be clear instructions in the documentation about how to register and get an access key. Every data provider is different in terms of what information they ask for in exchange for the access key, so there’s no general methodology beyond carefully following the instructions in the API documentation.</p>
<p><strong>Important:</strong> Once you have an access key, keep it SECRET. Treat it like a password. Do not share it, and if you are writing a script or notebook that involves calling an API with an access key, take steps (<a class="reference external" href="#secret">described below</a>) to hide your access key.</p>
<p>Let’s take the U.S. Census Bureau’s API as an example. To access this API we start with the <a class="reference external" href="https://www.census.gov/developers/">Developers</a> page on the Census Bureau’s website. In the bottom-left corner of the screen there’s a large button labeled “Request a Key” that links to this URL: https://api.census.gov/data/key_signup.html. In order to obtain a key, you will have to tell the Census your organization and email address, and you will have to agree to the Census’s terms of service. After supplying that information, click on “Submit Key Request”. You will receive an email after a few minutes containing your access key.</p>
<p>According to the Census’s (huge) <a class="reference external" href="https://www.census.gov/content/dam/Census/data/developers/api-user-guide/api-guide.pdf">API documentation</a>, the purpose of making users register for access keys is to limit the amount of use:</p>
<blockquote>
<div><p>You can include up to 50 variables in a single API query and can make up to 500 queries per IP address per day. More than 500 queries per IP address per day requires that you register for a Census key. That key will be part of your data request URL string (9).</p>
</div></blockquote>
<div class="section" id="how-to-keep-your-access-key-secret">
<h3><a class="toc-backref" href="#id8"><span class="section-number">4.3.1. </span>How to Keep Your Access Key Secret</a><a class="headerlink" href="#how-to-keep-your-access-key-secret" title="Permalink to this headline">¶</a></h3>
<p>People who are new to Python and APIs often make the mistake of explicitly writing a line of code that displays an access key, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CensusKey</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Putting the access key explicitly into a notebook or script will work for the purposes of getting the data from the API. But it will be a problem if you intend to share your code in any way. Declaring the key in this way is like announcing your password.</p>
<p>Instead, we will follow the protocol laid out by Jonathan Soma on his <a class="reference external" href="http://jonathansoma.com/lede/foundations-2019/classes/apis/keeping-api-keys-secret/">excellent blog</a> for writing scripts and notebooks that access APIs while keeping your keys secret.</p>
<div class="section" id="step-1-creating-a-environmental-variables-file">
<h4><a class="toc-backref" href="#id9"><span class="section-number">4.3.1.1. </span>Step 1: Creating a Environmental Variables File</a><a class="headerlink" href="#step-1-creating-a-environmental-variables-file" title="Permalink to this headline">¶</a></h4>
<p>The first step is to create a plain text file named <code class="docutils literal notranslate"><span class="pre">.env</span></code> in the same folder as your notebook or script. This file contains “environmental variables”, which are variables that exist in your server environment without being part of your code - they are loaded into Python’s memory in the background. Using environmental variables will allow you to share your code without having to share the sensitive information contained in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. To create a <code class="docutils literal notranslate"><span class="pre">.env</span></code> file using Jupyter Labs:</p>
<ol class="simple">
<li><p>Right click on your notebook and select “New Console for Notebook”. That launches a new console with the complete environment of your notebook loaded into it.</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os</span></code> and <code class="docutils literal notranslate"><span class="pre">os.getcwd()</span></code> into the console to confirm that the current working directory is the same folder where you have saved your notebook.</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">!touch</span> <span class="pre">.env</span></code> into the console. This command creates a blank text file in this folder named <code class="docutils literal notranslate"><span class="pre">.env</span></code>.</p></li>
</ol>
</div>
<div class="section" id="step-2-putting-access-keys-into-the-env-file">
<h4><a class="toc-backref" href="#id10"><span class="section-number">4.3.1.2. </span>Step 2: Putting Access Keys Into the <code class="docutils literal notranslate"><span class="pre">.env</span></code> File</a><a class="headerlink" href="#step-2-putting-access-keys-into-the-env-file" title="Permalink to this headline">¶</a></h4>
<p>Navigate to the folder where you created the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file and open it. If you do not see the file, it might be considered a hidden file by your operating system. On a Mac, open the folder using Finder and press the <strong>Shift, Command, and Period</strong> keys together. Then the hidden files will display. On Windows, follow these <a class="reference external" href="https://support.microsoft.com/en-us/help/14201/windows-show-hidden-files">instructions</a> to show the hidden files.</p>
<p>Once you’ve opened the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file, you will see a text editor with no text. Type your access keys into the text editor in the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CensusKey</span><span class="o">=</span><span class="n">abcdefghijklmnopqrstuvwxyz</span>
</pre></div>
</div>
<p>Don’t put spaces or quotes in what you type. If you want to save more than one key, that’s fine, just put each key on a new line. Finally, save the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file.</p>
</div>
<div class="section" id="step-3-loading-the-environmental-variables-into-python">
<h4><a class="toc-backref" href="#id11"><span class="section-number">4.3.1.3. </span>Step 3: Loading the Environmental Variables into Python</a><a class="headerlink" href="#step-3-loading-the-environmental-variables-into-python" title="Permalink to this headline">¶</a></h4>
<p>The easiest way to bring your keys into Python is to use the <code class="docutils literal notranslate"><span class="pre">dotenv</span></code> and <code class="docutils literal notranslate"><span class="pre">os</span></code> libraries Type <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">dotenv</span></code> in the console if you haven’t yet installed this library (or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">python-dotenv</span></code> into a terminal session if you run into an error with the standard pip install). Then type the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dotenv</span>
<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>

<span class="n">CensusKey</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;CensusKey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">CensusKey</span></code> is a Python variable that contains your secret access key. You will be able to pass this variable to <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code> to make calls to the Census API, and the key itself is never displayed on in the notebook. (You can type <code class="docutils literal notranslate"><span class="pre">CensusKey</span></code> in a cell to confirm that this worked, but be sure to delete that cell before sharing the notebook.) Better still, if you share the notebook or script with others who have also set up <code class="docutils literal notranslate"><span class="pre">.env</span></code> files on their own, then they can run the same calls using their own keys with no alterations to the code.</p>
</div>
<div class="section" id="step-4-using-the-access-key">
<h4><a class="toc-backref" href="#id12"><span class="section-number">4.3.1.4. </span>Step 4: Using the Access Key</a><a class="headerlink" href="#step-4-using-the-access-key" title="Permalink to this headline">¶</a></h4>
<p>Now that we have the access key stored in a Python variable we can pass it directly to the <code class="docutils literal notranslate"><span class="pre">params</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code> in a dictionary along with all of the other API parameters we specify.</p>
<p>For example, suppose I want to download the population of every U.S. state by accessing the Census API through Python and then organize these data in a data frame. First I find and read the Census <a class="reference external" href="https://www.census.gov/content/dam/Census/data/developers/api-user-guide/api-guide.pdf">API documentation</a>. The endpoint for population data is https://api.census.gov/data/2019/pep/charagegroups. I look at the documentation for this specific endpoint and find the list of parameters. There are three parameters I need to specify:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get</span></code>: allows us to choose the features we wish to obtain from the API. Here let’s get <code class="docutils literal notranslate"><span class="pre">GEO_ID</span></code> (the Census geocode for each state), and <code class="docutils literal notranslate"><span class="pre">POP</span></code> (the population).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span></code>: allows us to specify the geographic entities we want included in the data. Typing <code class="docutils literal notranslate"><span class="pre">state:*</span></code> tells the API to provide data on all of the states.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>: this is where I enter my API access key.</p></li>
</ul>
<p>In general, while values of API parameters should be entered in quotes, <code class="docutils literal notranslate"><span class="pre">CensusKey</span></code> should be entered without quotes to ensure that the value of <code class="docutils literal notranslate"><span class="pre">CensusKey</span></code> and not the string “CensusKey” is entered in the dictionary. The dictionary is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mydict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;get&#39;</span><span class="p">:</span><span class="s1">&#39;GEO_ID,POP&#39;</span><span class="p">,</span>
         <span class="s1">&#39;for&#39;</span><span class="p">:</span><span class="s1">&#39;state:*&#39;</span><span class="p">,</span>
         <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">CensusKey</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>To download the data from the API, I pass the endpoint and the parameter dictionary to <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.census.gov/data/2019/pep/charagegroups&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">mydict</span><span class="p">)</span>
<span class="n">r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Response [200]&gt;
</pre></div>
</div>
</div>
</div>
<p>Response 200 means that the connection to the API and the request were both successful. To see the output of the request, I look at the <code class="docutils literal notranslate"><span class="pre">.text</span></code> attribute:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;[[&quot;GEO_ID&quot;,&quot;POP&quot;,&quot;state&quot;],\n[&quot;0400000US28&quot;,&quot;2976149&quot;,&quot;28&quot;],\n[&quot;0400000US29&quot;,&quot;6137428&quot;,&quot;29&quot;],\n[&quot;0400000US30&quot;,&quot;1068778&quot;,&quot;30&quot;],\n[&quot;0400000US31&quot;,&quot;1934408&quot;,&quot;31&quot;],\n[&quot;0400000US32&quot;,&quot;3080156&quot;,&quot;32&quot;],\n[&quot;0400000US33&quot;,&quot;1359711&quot;,&quot;33&quot;],\n[&quot;0400000US34&quot;,&quot;8882190&quot;,&quot;34&quot;],\n[&quot;0400000US35&quot;,&quot;2096829&quot;,&quot;35&quot;],\n[&quot;0400000US36&quot;,&quot;19453561&quot;,&quot;36&quot;],\n[&quot;0400000US37&quot;,&quot;10488084&quot;,&quot;37&quot;],\n[&quot;0400000US38&quot;,&quot;762062&quot;,&quot;38&quot;],\n[&quot;0400000US39&quot;,&quot;11689100&quot;,&quot;39&quot;],\n[&quot;0400000US40&quot;,&quot;3956971&quot;,&quot;40&quot;],\n[&quot;0400000US41&quot;,&quot;4217737&quot;,&quot;41&quot;],\n[&quot;0400000US42&quot;,&quot;12801989&quot;,&quot;42&quot;],\n[&quot;0400000US44&quot;,&quot;1059361&quot;,&quot;44&quot;],\n[&quot;0400000US45&quot;,&quot;5148714&quot;,&quot;45&quot;],\n[&quot;0400000US46&quot;,&quot;884659&quot;,&quot;46&quot;],\n[&quot;0400000US47&quot;,&quot;6829174&quot;,&quot;47&quot;],\n[&quot;0400000US48&quot;,&quot;28995881&quot;,&quot;48&quot;],\n[&quot;0400000US50&quot;,&quot;623989&quot;,&quot;50&quot;],\n[&quot;0400000US49&quot;,&quot;3205958&quot;,&quot;49&quot;],\n[&quot;0400000US51&quot;,&quot;8535519&quot;,&quot;51&quot;],\n[&quot;0400000US53&quot;,&quot;7614893&quot;,&quot;53&quot;],\n[&quot;0400000US54&quot;,&quot;1792147&quot;,&quot;54&quot;],\n[&quot;0400000US55&quot;,&quot;5822434&quot;,&quot;55&quot;],\n[&quot;0400000US56&quot;,&quot;578759&quot;,&quot;56&quot;],\n[&quot;0400000US72&quot;,&quot;3193694&quot;,&quot;72&quot;],\n[&quot;0400000US01&quot;,&quot;4903185&quot;,&quot;01&quot;],\n[&quot;0400000US02&quot;,&quot;731545&quot;,&quot;02&quot;],\n[&quot;0400000US04&quot;,&quot;7278717&quot;,&quot;04&quot;],\n[&quot;0400000US05&quot;,&quot;3017804&quot;,&quot;05&quot;],\n[&quot;0400000US06&quot;,&quot;39512223&quot;,&quot;06&quot;],\n[&quot;0400000US08&quot;,&quot;5758736&quot;,&quot;08&quot;],\n[&quot;0400000US10&quot;,&quot;973764&quot;,&quot;10&quot;],\n[&quot;0400000US11&quot;,&quot;705749&quot;,&quot;11&quot;],\n[&quot;0400000US09&quot;,&quot;3565287&quot;,&quot;09&quot;],\n[&quot;0400000US12&quot;,&quot;21477737&quot;,&quot;12&quot;],\n[&quot;0400000US13&quot;,&quot;10617423&quot;,&quot;13&quot;],\n[&quot;0400000US16&quot;,&quot;1787065&quot;,&quot;16&quot;],\n[&quot;0400000US15&quot;,&quot;1415872&quot;,&quot;15&quot;],\n[&quot;0400000US17&quot;,&quot;12671821&quot;,&quot;17&quot;],\n[&quot;0400000US18&quot;,&quot;6732219&quot;,&quot;18&quot;],\n[&quot;0400000US19&quot;,&quot;3155070&quot;,&quot;19&quot;],\n[&quot;0400000US20&quot;,&quot;2913314&quot;,&quot;20&quot;],\n[&quot;0400000US21&quot;,&quot;4467673&quot;,&quot;21&quot;],\n[&quot;0400000US22&quot;,&quot;4648794&quot;,&quot;22&quot;],\n[&quot;0400000US23&quot;,&quot;1344212&quot;,&quot;23&quot;],\n[&quot;0400000US24&quot;,&quot;6045680&quot;,&quot;24&quot;],\n[&quot;0400000US25&quot;,&quot;6892503&quot;,&quot;25&quot;],\n[&quot;0400000US26&quot;,&quot;9986857&quot;,&quot;26&quot;],\n[&quot;0400000US27&quot;,&quot;5639632&quot;,&quot;27&quot;]]&#39;
</pre></div>
</div>
</div>
</div>
<p>The data are organized as a list of lists, where each element is a list of the data for each individual state. The first list contains the column names. To convert the data to a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frame I use <code class="docutils literal notranslate"><span class="pre">json.loads()</span></code> to register the data as JSON, then <code class="docutils literal notranslate"><span class="pre">pd.DataFrame()</span></code> to convert the JSON to a data frame. I remove the first element and set it as the column names.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">statepop</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">statepopDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">statepop</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">statepop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">statepopDF</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GEO_ID</th>
      <th>POP</th>
      <th>state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0400000US28</td>
      <td>2976149</td>
      <td>28</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0400000US29</td>
      <td>6137428</td>
      <td>29</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0400000US30</td>
      <td>1068778</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0400000US31</td>
      <td>1934408</td>
      <td>31</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0400000US32</td>
      <td>3080156</td>
      <td>32</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0400000US33</td>
      <td>1359711</td>
      <td>33</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0400000US34</td>
      <td>8882190</td>
      <td>34</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0400000US35</td>
      <td>2096829</td>
      <td>35</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0400000US36</td>
      <td>19453561</td>
      <td>36</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0400000US37</td>
      <td>10488084</td>
      <td>37</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0400000US38</td>
      <td>762062</td>
      <td>38</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0400000US39</td>
      <td>11689100</td>
      <td>39</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0400000US40</td>
      <td>3956971</td>
      <td>40</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0400000US41</td>
      <td>4217737</td>
      <td>41</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0400000US42</td>
      <td>12801989</td>
      <td>42</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0400000US44</td>
      <td>1059361</td>
      <td>44</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0400000US45</td>
      <td>5148714</td>
      <td>45</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0400000US46</td>
      <td>884659</td>
      <td>46</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0400000US47</td>
      <td>6829174</td>
      <td>47</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0400000US48</td>
      <td>28995881</td>
      <td>48</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0400000US50</td>
      <td>623989</td>
      <td>50</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0400000US49</td>
      <td>3205958</td>
      <td>49</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0400000US51</td>
      <td>8535519</td>
      <td>51</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0400000US53</td>
      <td>7614893</td>
      <td>53</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0400000US54</td>
      <td>1792147</td>
      <td>54</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0400000US55</td>
      <td>5822434</td>
      <td>55</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0400000US56</td>
      <td>578759</td>
      <td>56</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0400000US72</td>
      <td>3193694</td>
      <td>72</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0400000US01</td>
      <td>4903185</td>
      <td>01</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0400000US02</td>
      <td>731545</td>
      <td>02</td>
    </tr>
    <tr>
      <th>30</th>
      <td>0400000US04</td>
      <td>7278717</td>
      <td>04</td>
    </tr>
    <tr>
      <th>31</th>
      <td>0400000US05</td>
      <td>3017804</td>
      <td>05</td>
    </tr>
    <tr>
      <th>32</th>
      <td>0400000US06</td>
      <td>39512223</td>
      <td>06</td>
    </tr>
    <tr>
      <th>33</th>
      <td>0400000US08</td>
      <td>5758736</td>
      <td>08</td>
    </tr>
    <tr>
      <th>34</th>
      <td>0400000US10</td>
      <td>973764</td>
      <td>10</td>
    </tr>
    <tr>
      <th>35</th>
      <td>0400000US11</td>
      <td>705749</td>
      <td>11</td>
    </tr>
    <tr>
      <th>36</th>
      <td>0400000US09</td>
      <td>3565287</td>
      <td>09</td>
    </tr>
    <tr>
      <th>37</th>
      <td>0400000US12</td>
      <td>21477737</td>
      <td>12</td>
    </tr>
    <tr>
      <th>38</th>
      <td>0400000US13</td>
      <td>10617423</td>
      <td>13</td>
    </tr>
    <tr>
      <th>39</th>
      <td>0400000US16</td>
      <td>1787065</td>
      <td>16</td>
    </tr>
    <tr>
      <th>40</th>
      <td>0400000US15</td>
      <td>1415872</td>
      <td>15</td>
    </tr>
    <tr>
      <th>41</th>
      <td>0400000US17</td>
      <td>12671821</td>
      <td>17</td>
    </tr>
    <tr>
      <th>42</th>
      <td>0400000US18</td>
      <td>6732219</td>
      <td>18</td>
    </tr>
    <tr>
      <th>43</th>
      <td>0400000US19</td>
      <td>3155070</td>
      <td>19</td>
    </tr>
    <tr>
      <th>44</th>
      <td>0400000US20</td>
      <td>2913314</td>
      <td>20</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0400000US21</td>
      <td>4467673</td>
      <td>21</td>
    </tr>
    <tr>
      <th>46</th>
      <td>0400000US22</td>
      <td>4648794</td>
      <td>22</td>
    </tr>
    <tr>
      <th>47</th>
      <td>0400000US23</td>
      <td>1344212</td>
      <td>23</td>
    </tr>
    <tr>
      <th>48</th>
      <td>0400000US24</td>
      <td>6045680</td>
      <td>24</td>
    </tr>
    <tr>
      <th>49</th>
      <td>0400000US25</td>
      <td>6892503</td>
      <td>25</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0400000US26</td>
      <td>9986857</td>
      <td>26</td>
    </tr>
    <tr>
      <th>51</th>
      <td>0400000US27</td>
      <td>5639632</td>
      <td>27</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-python-libraries-that-directly-interface-with-a-particular-api">
<h2><a class="toc-backref" href="#id13"><span class="section-number">4.4. </span>Using Python Libraries that Directly Interface With a Particular API</a><a class="headerlink" href="#using-python-libraries-that-directly-interface-with-a-particular-api" title="Permalink to this headline">¶</a></h2>
<p>Many APIs now have their own specialized libraries for Python that wrap around the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library so that you don’t need any calls to <code class="docutils literal notranslate"><span class="pre">requests</span></code>. These libraries (mostly) try to make the process of working with a complicated API much easier and more user friendly. We’ll discuss two examples here. The main library for working with the Twitter API in Python is <code class="docutils literal notranslate"><span class="pre">tweepy</span></code>, and the library for working with the Google Maps API is <code class="docutils literal notranslate"><span class="pre">googlemaps</span></code>. If you haven’t yet done so, please install these two libraries.</p>
<div class="section" id="using-an-api-with-credentialling-and-limits-example-twitter">
<h3><a class="toc-backref" href="#id14"><span class="section-number">4.4.1. </span>Using an API with Credentialling and Limits (Example: Twitter)</a><a class="headerlink" href="#using-an-api-with-credentialling-and-limits-example-twitter" title="Permalink to this headline">¶</a></h3>
<p>Twitter limits the use of its API to people who apply for and are granted a special “Twitter developer” account. To apply for a developer account, follow these steps:</p>
<ol class="simple">
<li><p>Go to https://dev.twitter.com/apps/new and log in to with your Twitter username and password (get a regular Twitter account first if you don’t yet have one).</p></li>
<li><p>Click on “Create an app”.</p></li>
<li><p>You will be prompted to apply for a developer account if you haven’t yet done so (if you already have an account, sign in and skip to step 4). Click “apply”, then:</p></li>
</ol>
<p>a. Request access for personal use. Give your account a name and select your country.</p>
<p>b. On the next page, select academic research or another topic if any are relevant.</p>
<p>c. Under “Describe in your own words what you are building” I typed the following: “(1) I’m using Twitter’s APIs to teach myself how to download and analyze Twitter data (2) I plan to analyze Tweets to understand how APIs and natural language processing work (3) No, I will not be Tweeting content (4) Tweets will not be displayed to any users” You should probably adapt the language to suit your own purposes and because we shouldn’t send dozens of identical applications to Twitter.</p>
<p>d. Agree to the terms-of-service, click through, and check your email for a confirmation link to click</p>
<p>e. Once you’ve confirmed your email address, proceed to https://developer.twitter.com/en/account/get-started and click on “Create an app”. Then click on the blue “Create an app” button in the upper-right corner.</p>
<ol class="simple">
<li><p>Enter your Application Name (something like “Jon’s twitter app” is fine), Description (“An app for Jon to use as he learns how to download data from Twitter” worked for me), and your website URL (I used www.virginia.edu). Under “Tell us how this app will be used” I wrote “I’m using this app to learn how to download data from Twitter into Python for the purpose of studying how to use APIs.” You can leave the other parts of the form empty.</p></li>
<li><p>Submit the form by clicking the Create your Twitter Application. This takes you to a page for your app. Click on “Keys and tokens” along the top.</p></li>
<li><p>Click on “Generate” under “Access token &amp; access token secret.”</p></li>
<li><p>You should now see <strong>four strings of random letters and numbers</strong>. The first the consumer API key. The second the the API secret key. The third is the access token, and the fourth is the access token secret.  <strong>Keep these numbers secret!</strong>  Keep this page open so you can copy and paste into your <code class="docutils literal notranslate"><span class="pre">.env</span></code> file.</p></li>
</ol>
<p>Once you have your consumer key, consumer secret, access token, and access token secret, paste the four strings into a <code class="docutils literal notranslate"><span class="pre">.env</span></code> for your project, as <a class="reference external" href="#secret">described above</a>. I bring these keys from the envirnomental variables to working variables in the Python environment by typing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ConsumerKey</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ConsumerKey&#39;</span><span class="p">)</span>
<span class="n">ConsumerSecret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;ConsumerSecret&#39;</span><span class="p">)</span>
<span class="n">AccessToken</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;AccessToken&#39;</span><span class="p">)</span>
<span class="n">AccessTokenSecret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;AccessTokenSecret&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this example, our goal is to collect recent <strong>tweets that contain the hashtag #uva</strong>.</p>
<p>Many large organizations with APIs have built specialized modules in Python to facilitate using the API directly in Python. For Twitter, the module that works best with the Twitter API is <code class="docutils literal notranslate"><span class="pre">tweepy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tweepy</span>
</pre></div>
</div>
</div>
</div>
<p>We pass our keys to the Twitter API with the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">ConsumerKey</span><span class="p">,</span> <span class="n">ConsumerSecret</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">AccessToken</span><span class="p">,</span> <span class="n">AccessTokenSecret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve set up our credentials, we can access the Twitter API without having to build a URL or use <code class="docutils literal notranslate"><span class="pre">requests</span></code>. The <code class="docutils literal notranslate"><span class="pre">.cursor()</span></code> method allows us to pass parameters from the Twiiter API documentation directly to the call to the API. The list of parameters for searching through tweets is here: https://developer.twitter.com/en/docs/tweets/search/api-reference/get-search-tweets. Notice the parameter <code class="docutils literal notranslate"><span class="pre">q</span></code> = “A UTF-8, URL-encoded search query of 500 characters maximum, including operators. Queries may additionally be limited by complexity.” We can use this parameter to enter opur search term “#uva”.</p>
<p>In the code below, we use the <code class="docutils literal notranslate"><span class="pre">.search</span></code> method applied to <code class="docutils literal notranslate"><span class="pre">api</span></code>, and we pass the search term we need. We also use the method <code class="docutils literal notranslate"><span class="pre">items(30)</span></code> to limit the number of returned tweets to 30.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uva_tweets</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s1">&#39;#uva&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>According to the <code class="docutils literal notranslate"><span class="pre">tweepy</span></code> documentation on the <code class="docutils literal notranslate"><span class="pre">.cursor()</span></code> method (http://docs.tweepy.org/en/v3.5.0/cursor_tutorial.html) the best way to explore the output is with a loop.  In the following code, I first create empty lists named <code class="docutils literal notranslate"><span class="pre">msgs</span></code> and <code class="docutils literal notranslate"><span class="pre">msg</span></code> – <code class="docutils literal notranslate"><span class="pre">msg</span></code> will contain a tuple of the data I want to extract from a single tweet, and <code class="docutils literal notranslate"><span class="pre">msgs</span></code> will append this information together across tweets. I then save the <code class="docutils literal notranslate"><span class="pre">msgs</span></code> array as a dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msgs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">msg</span> <span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s1">&#39;#uva&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">]</span> 
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>                    
    <span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>created_at</th>
      <th>user</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 19:24:13</td>
      <td>ardilla37003783</td>
    </tr>
    <tr>
      <th>1</th>
      <td>RT @LuisContigiani: En estos días se habla de ...</td>
      <td>2020-08-04 19:24:06</td>
      <td>uvacaba</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 19:24:06</td>
      <td>ProfeMolina1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>RT @LuisContigiani: En estos días se habla de ...</td>
      <td>2020-08-04 19:22:29</td>
      <td>marialaura2025</td>
    </tr>
    <tr>
      <th>4</th>
      <td>RT @ByDavidTeel: Transfer from Notre Dame elig...</td>
      <td>2020-08-04 19:15:10</td>
      <td>BFriedACC</td>
    </tr>
    <tr>
      <th>5</th>
      <td>RT @tinavargasv: La #uva #pinotnoir ofrecen #v...</td>
      <td>2020-08-04 19:14:36</td>
      <td>Viviannis</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Transfer from Notre Dame eligible to play this...</td>
      <td>2020-08-04 19:11:41</td>
      <td>ByDavidTeel</td>
    </tr>
    <tr>
      <th>7</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 19:06:42</td>
      <td>FlorenciaSahd</td>
    </tr>
    <tr>
      <th>8</th>
      <td>We're back with another #TipTuesday! This week...</td>
      <td>2020-08-04 19:04:36</td>
      <td>UVAadmission</td>
    </tr>
    <tr>
      <th>9</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:58:43</td>
      <td>GMarianaGuida</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Thanks to the league’s restructured schedule, ...</td>
      <td>2020-08-04 18:52:46</td>
      <td>Cavs_Corner</td>
    </tr>
    <tr>
      <th>11</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:40:49</td>
      <td>leastuka</td>
    </tr>
    <tr>
      <th>12</th>
      <td>RT @Wahoos247: Washington Football Team announ...</td>
      <td>2020-08-04 18:39:21</td>
      <td>FatWhite101</td>
    </tr>
    <tr>
      <th>13</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:37:31</td>
      <td>inesrialperalta</td>
    </tr>
    <tr>
      <th>14</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:31:46</td>
      <td>lila_tote</td>
    </tr>
    <tr>
      <th>15</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:29:08</td>
      <td>LisandroTosello</td>
    </tr>
    <tr>
      <th>16</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:24:07</td>
      <td>Mara63848310</td>
    </tr>
    <tr>
      <th>17</th>
      <td>UVA delays opening for in-person classes by tw...</td>
      <td>2020-08-04 18:17:28</td>
      <td>bobgibsoncville</td>
    </tr>
    <tr>
      <th>18</th>
      <td>In the 4th installment of our COVID exposed se...</td>
      <td>2020-08-04 18:15:05</td>
      <td>UnitedWayCville</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Teams with an argument to be No. 1 in college ...</td>
      <td>2020-08-04 18:13:11</td>
      <td>hoosdaily</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(2/2) @presjimryan and #UVA leaders just sent ...</td>
      <td>2020-08-04 18:12:43</td>
      <td>MattTalhelm</td>
    </tr>
    <tr>
      <th>21</th>
      <td>"In Charlottesville and Albemarle County, we h...</td>
      <td>2020-08-04 18:10:53</td>
      <td>B2Ninon</td>
    </tr>
    <tr>
      <th>22</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:03:32</td>
      <td>phanterr</td>
    </tr>
    <tr>
      <th>23</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 18:02:08</td>
      <td>Estebanfgonz</td>
    </tr>
    <tr>
      <th>24</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 17:57:52</td>
      <td>CarolinaSa80</td>
    </tr>
    <tr>
      <th>25</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 17:56:34</td>
      <td>DarioPuppa</td>
    </tr>
    <tr>
      <th>26</th>
      <td>#Uva podrida uva perdida?\nPor @dmanso73 Vía @...</td>
      <td>2020-08-04 17:56:22</td>
      <td>enoturEspana</td>
    </tr>
    <tr>
      <th>27</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 17:55:13</td>
      <td>PalandriPamela</td>
    </tr>
    <tr>
      <th>28</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 17:52:36</td>
      <td>DiegoAlfCardozo</td>
    </tr>
    <tr>
      <th>29</th>
      <td>RT @LisandroTosello: Celebro que @alferdez rel...</td>
      <td>2020-08-04 17:52:22</td>
      <td>AntunaReitu</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="using-an-api-that-requires-a-user-to-send-data-to-the-api-first-example-google-maps">
<h3><a class="toc-backref" href="#id15"><span class="section-number">4.4.2. </span>Using an API that Requires a User to Send Data to the API First (Example: Google Maps)</a><a class="headerlink" href="#using-an-api-that-requires-a-user-to-send-data-to-the-api-first-example-google-maps" title="Permalink to this headline">¶</a></h3>
<p>APIs are a two-way system of data transfer. Not only can we pull data from APIs (a GET request), we can send data to remote servers using APIs (a POST request). For some applicaitons of APIs, we need to provide data to the server so that the server knows what data to send back to us. One example of this interchange is using the Google Maps API to get the latitude-longitude coordinates for an address, so that we can plot addresses on a map. The goal in this example is to get the coordinates for the address for “60 Bonnycastle Dr Charlottesville, VA 22904”, otherwise known as the Dell, where the offices for the UVA School of Data Science are located.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;60 Bonnycastle Dr Charlottesville, VA 22904&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>As with Twitter, the Google Maps API is a credentialed system. To obtain the proper keys, go to https://console.cloud.google.com/projectselector2/apis/credentials?pli=1&amp;supportedpurview=project and sign in to your Google account. Choose your country and agree to the terms of service. Click on “create”, and choose a project name, organization name, and location (a website) for your organization. It doesn’t really matter what these are. That will bring you back to the main page, where after a minute a page for your project will appear. If you click on the project main page, along the left-hand side there’s a link for “APIs and Services”: click on “Credentials”, then click on the “Create credentials” button, and “API Key”. The API key will appear. Copy and paste it into your <code class="docutils literal notranslate"><span class="pre">.env</span></code> file.</p>
<p>I load the key into Python’s environment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GoogleKey</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;GoogleKey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You will also need to enable your API to be able to use place location. Navigate to the main dashboard for your app. At the top click the button marked “APIs &amp; Services”. Find “Geocoding API”: click it, then push “Enable”. (Note: it can take about 5 minutes for changes to take effect). You might also have to sign up for a Google Cloud billing acount. If you never use Google Cloud, they won’t charge you, so feel free to sign up.</p>
<p>The easiest way to interface with the Google Maps API in Python is to use the <code class="docutils literal notranslate"><span class="pre">googlemaps</span></code> library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">googlemaps</span>
</pre></div>
</div>
</div>
</div>
<p>To issue your credentials to the Google Maps API, use the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmaps</span> <span class="o">=</span> <span class="n">googlemaps</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">GoogleKey</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we’ve created a session with the Google Maps API, we can use the <code class="docutils literal notranslate"><span class="pre">.geocode()</span></code> method to search for a particular address, and to return all information about that address in JSON format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geocode_result</span> <span class="o">=</span> <span class="n">gmaps</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="s1">&#39;60 Bonnycastle Dr Charlottesville, VA 22904&#39;</span><span class="p">)</span>
<span class="n">geocode_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[{&#39;address_components&#39;: [{&#39;long_name&#39;: &#39;60&#39;,
    &#39;short_name&#39;: &#39;60&#39;,
    &#39;types&#39;: [&#39;street_number&#39;]},
   {&#39;long_name&#39;: &#39;Bonnycastle Drive&#39;,
    &#39;short_name&#39;: &#39;Bonnycastle Dr&#39;,
    &#39;types&#39;: [&#39;route&#39;]},
   {&#39;long_name&#39;: &#39;Charlottesville&#39;,
    &#39;short_name&#39;: &#39;Charlottesville&#39;,
    &#39;types&#39;: [&#39;locality&#39;, &#39;political&#39;]},
   {&#39;long_name&#39;: &#39;Jack Jouett&#39;,
    &#39;short_name&#39;: &#39;Jack Jouett&#39;,
    &#39;types&#39;: [&#39;administrative_area_level_3&#39;, &#39;political&#39;]},
   {&#39;long_name&#39;: &#39;Albemarle County&#39;,
    &#39;short_name&#39;: &#39;Albemarle County&#39;,
    &#39;types&#39;: [&#39;administrative_area_level_2&#39;, &#39;political&#39;]},
   {&#39;long_name&#39;: &#39;Virginia&#39;,
    &#39;short_name&#39;: &#39;VA&#39;,
    &#39;types&#39;: [&#39;administrative_area_level_1&#39;, &#39;political&#39;]},
   {&#39;long_name&#39;: &#39;United States&#39;,
    &#39;short_name&#39;: &#39;US&#39;,
    &#39;types&#39;: [&#39;country&#39;, &#39;political&#39;]},
   {&#39;long_name&#39;: &#39;22904&#39;, &#39;short_name&#39;: &#39;22904&#39;, &#39;types&#39;: [&#39;postal_code&#39;]}],
  &#39;formatted_address&#39;: &#39;60 Bonnycastle Dr, Charlottesville, VA 22904, USA&#39;,
  &#39;geometry&#39;: {&#39;location&#39;: {&#39;lat&#39;: 38.034853, &#39;lng&#39;: -78.51006799999999},
   &#39;location_type&#39;: &#39;ROOFTOP&#39;,
   &#39;viewport&#39;: {&#39;northeast&#39;: {&#39;lat&#39;: 38.03620198029149,
     &#39;lng&#39;: -78.50871901970848},
    &#39;southwest&#39;: {&#39;lat&#39;: 38.0335040197085, &#39;lng&#39;: -78.5114169802915}}},
  &#39;place_id&#39;: &#39;ChIJZePLx1qGs4kRxhmpz-e7edo&#39;,
  &#39;plus_code&#39;: {&#39;compound_code&#39;: &#39;2FMQ+WX Charlottesville, VA, USA&#39;,
   &#39;global_code&#39;: &#39;87C32FMQ+WX&#39;},
  &#39;types&#39;: [&#39;street_address&#39;]}]
</pre></div>
</div>
</div>
</div>
<p>Because the output is formatted as a list in which the only element is a dictionary, we start by calling the 0 item of the list. We can then find the latitude and longitude coordinates with the following path:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geocode_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;lat&#39;: 38.034853, &#39;lng&#39;: -78.51006799999999}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="ch3.html" title="previous page"><span class="section-number">3. </span>Loading, Converting, and Writing JSON Files</a>
    <a class='right-next' id="next-link" href="ch5.html" title="next page"><span class="section-number">5. </span>Web Scraping Using <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code></a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Jonathan Kropko (jkropko@virginia.edu)<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>